<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Getting Started with OpenPose &amp; SMPLify-X - KychDev</title><meta name="gridsome:hash" content="2475fdc4e4566cccaf2bc2f4289d351f998d1abe"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.21"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css"><link rel="preload" href="/assets/css/0.styles.5d172acf.css" as="style"><link rel="preload" href="/assets/js/app.c9f38b1d.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--blogpost-vue.9b21b359.js" as="script"><link rel="preload" href="/assets/js/vue-remark--content--blog--01-smplifyx-containers-md.b7d749c7.js" as="script"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.27c4288c.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.ce7866cf.js"><link rel="prefetch" href="/assets/js/page--src--pages--all-posts-vue.023fae85.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-vue.22b8e8a7.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.38eb7b4f.js"><link rel="prefetch" href="/assets/js/page--src--templates--collection-vue.e697c0ea.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.464bc67f.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--index-vue.01307251.js"><link rel="prefetch" href="/assets/js/vue-remark--content--blog--02-ml-categories-md.a9464c13.js"><link rel="prefetch" href="/assets/js/vue-remark--content--blog--03-introduction-to-object-detection-md.c8051b6a.js"><link rel="prefetch" href="/assets/js/vue-remark--content--collections--intro-deep-learning-md.4499e7e4.js"><link rel="stylesheet" href="/assets/css/0.styles.5d172acf.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body class="has-navbar-fixed-top" data-vue-tag="%7B%22class%22:%7B%22ssr%22:%22has-navbar-fixed-top%22%7D%7D">
    <div data-server-rendered="true" id="app" class="layout"><nav aria-label="main navigation" id="navbar" role="navigation" class="navbar is-fixed-top"><div class="container"><div class="navbar-brand"><a href="/" class="navbar-item active"><span class="has-text-weight-bold has-text-primary">Kych</span><span class="has-text-weight-bold has-text-warning"><sup>Dev</sup></span></a><a aria-expanded="false" aria-label="menu" data-target="navbarBasicExample" role="button" class="navbar-burger burger"><span aria-hidden="true"></span><span aria-hidden="true"></span><span aria-hidden="true"></span></a></div><div id="navbarBasicExample" class="navbar-menu"><div class="navbar-end"><a href="/" class="navbar-item has-text-primary is-active">
                    Home
                </a><a href="/blog" class="navbar-item has-text-info is-active">
                    Blog
                </a><a href="/files/misc/ChiragKaria_Resume.pdf" target="_blank" class="navbar-item has-text-success">
                    Resume
                </a><a href="/about" class="navbar-item has-text-warning">
                    About Me
                </a></div></div></div></nav><div><div class="section" style="padding-bottom: 0px"><div class="container"><nav class="columns"><div class="column is-three-fifths"><div><p class="title is-2">Getting Started with OpenPose &amp; SMPLify-X</p><!----><div class="is-hidden-tablet" style="margin-bottom: 1.5em"><p>Posted: Fri, 07 Aug 2020</p><p>By: Chirag Karia</p></div><div><strong> Tags: </strong><span><a href="/tags/3-d-body-models/">3D Body Models</a><span>, </span></span><span><a href="/tags/development-environment/">Development Environment</a><span>, </span></span><span><a href="/tags/docker/">Docker</a><span>, </span></span><span><a href="/tags/open-pose/">OpenPose</a><span>, </span></span><span><a href="/tags/smp-lify-x/">SMPLify-X</a><!----></span></div></div></div><div class="column is-hidden-mobile is-two-fifths has-text-right"><p class="subtitle" style="margin-bottom: 0em;"> Posted: Fri, 07 Aug 2020</p><p class="subtitle"> By: Chirag Karia</p></div></nav></div></div><div id="contentSection" class="section"><div class="container"><div class="content is-medium"><div><h1 id="introduction"><a href="#introduction" aria-hidden="true"><span class="icon icon-link"></span></a>Introduction</h1><figure><div class="columns"><div class="column"><img alt="Source image for body model" src="/files/post-images/smplify-x-container/me.jpg" class="image g-image"></div><div class="column"><img alt="Image with rendered body model" src="/files/post-images/smplify-x-container/me_body_model.png" class="image g-image"></div></div><figcaption>
        A source image and the corresponding body model made using the OpenPose and SMPLify-X containers
    </figcaption></figure><p>This is a more detailed post on how to leverage the containers for <a href="https://smpl-x.is.tue.mpg.de/" target="_blank" rel="nofollow noopener noreferrer">SMPLify-X</a> and 
<a href="https://github.com/CMU-Perceptual-Computing-Lab/openpose" target="_blank" rel="nofollow noopener noreferrer">OpenPose</a> that I provide in my 
<a href="https://github.com/kidkych/smplifyx-and-openpose-containers" target="_blank" rel="nofollow noopener noreferrer">public repo</a>. </p><p>SMPLify-X is a computer vision algorithm that creates an expressive body model of  individuals using a single image.
However, downloading and running the code is slightly difficult, and requires building a few different packages as 
dependencies. OpenPose is a 2D human pose model that extracts the joints and other keypoints of an individual from a 
single image. SMPLify-X requires that you have 
OpenPose setup and functional which in itself can be tough. Further, even if you take all the correct steps 
to get SMPLify-X working, doing it with a conda environment the 
<a href="https://github.com/vchoutas/torch-mesh-isect" target="_blank" rel="nofollow noopener noreferrer">torch-mesh-isect</a> package can throw a segmentation fault without any
information as to why. The repo author suggests that SMPLify-X should be used with either the system's installation of 
python3, or to use <a href="https://docs.python.org/3/library/venv.html" target="_blank" rel="nofollow noopener noreferrer">venv</a>.</p><p>I personally do not like working with the system installation of python on my native OS; venv could be a
potential solution but SMPLify-X and OpenPose require building quite a few packages so I'd rather containerize them to
ensure it's portable and simple to get running on a new system. I figured I'd write a more detailed how-to guide here 
than what is provided by my repo's README just to help those who are new to Docker for machine learning.</p><h1 id="table-of-contents"><a href="#table-of-contents" aria-hidden="true"><span class="icon icon-link"></span></a>Table of Contents</h1><ul><li><p><a href="#1---prerequisites">1 - Prerequisites</a></p><ul><li><p><a href="#11---set-up-docker-for-gpu-passthrough">1.1 - Set Up Docker for GPU Passthrough</a></p><ul><li><a href="#1-install-docker-190312">1) Install Docker 19.03.12</a></li><li><a href="#2-install-the-nvidia-container-toolkit">2) Install the NVIDIA Container Toolkit</a></li></ul></li></ul></li><li><p><a href="#2---running-smplify-x-on-your-own-images">2 - Running SMPLify-X on Your Own Images</a></p></li><li><p><a href="#3---using-the-smplify-x-container-for-development">3 - Using the SMPLify-X Container for Development</a></p></li></ul><h1 id="1---prerequisites"><a href="#1---prerequisites" aria-hidden="true"><span class="icon icon-link"></span></a>1 - Prerequisites</h1><p>There are four main requirements to keep in mind when using these containers.</p><ol><li>A Linux based OS </li><li>A CUDA enabled GPU that supports CUDA 10</li><li>Sudo access</li><li>Docker set up such that you can passthrough GPUs to docker containers</li></ol><p>The first three are based on your software and hardware configuration, but the last one will require to install the
latest version of Docker (19.03.12 as of this writing) and the NVIDIA container toolkit. Note, the host system does not 
need to have CUDA itself installed, but it must have the NVIDIA drivers. I'll highlight the steps to install Docker and
the NVIDIA Container Toolkit next.</p><h2 id="11---set-up-docker-for-gpu-passthrough"><a href="#11---set-up-docker-for-gpu-passthrough" aria-hidden="true"><span class="icon icon-link"></span></a>1.1 - Set Up Docker for GPU Passthrough</h2><p>If you are using an older version of Docker (&lt; 19.03.12) and already enabled GPU support using nvidia-docker2 then you
simply need to update your Docker installation and everything should work. However nvidia-docker2 will soon be 
deprecated so I would suggest uninstalling it, and installing the nvidia-container-toolkit. If you have neither Docker, 
or the nvidia packages to enable GPU passthrough follow the instructions below. If you do, you may skip to section 2.</p><h3 id="1-install-docker-190312"><a href="#1-install-docker-190312" aria-hidden="true"><span class="icon icon-link"></span></a>1) Install Docker 19.03.12</h3><p>Note these instructions are for Ubuntu 16.04 or later, and Debian Jessie or later. They have been retrieved from 
<a href="https://docs.docker.com/engine/install/" target="_blank" rel="nofollow noopener noreferrer">Docker's own website</a>. Please refer to their instructions if you're using an
ARM based system, or installing on a linux distribution that isn't Ubuntu or Debian.</p><p>First we must set up our system to enable support for adding new repositories over HTTPS</p><pre class="language-shell"><code class="language-shell"><span class="token comment"># Update package manager repositories</span>
$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update

<span class="token comment"># Install dependencies for adding a new repository to package manager</span>
$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token punctuation">\</span>
    apt-transport-https <span class="token punctuation">\</span>
    ca-certificates <span class="token punctuation">\</span>
    <span class="token function">curl</span> <span class="token punctuation">\</span>
    gnupg-agent <span class="token punctuation">\</span>
    software-properties-common</code></pre><p>After the previous step, we must add the Docker repository relevant to our system</p><pre class="language-shell"><code class="language-shell"><span class="token comment"># Ubuntu</span>
$ <span class="token function">curl</span> -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
$ <span class="token function">sudo</span> add-apt-repository <span class="token punctuation">\</span>
   <span class="token string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> \
   stable&quot;</span>

<span class="token comment"># Debian</span>
$ <span class="token function">curl</span> -fsSL https://download.docker.com/linux/debian/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
$ <span class="token function">sudo</span> add-apt-repository <span class="token punctuation">\</span>
   <span class="token string">&quot;deb [arch=amd64] https://download.docker.com/linux/debian \
   <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> \
   stable&quot;</span></code></pre><p>Make sure you have the right key.</p><pre class="language-shell"><code class="language-shell">$ <span class="token function">sudo</span> apt-key fingerprint 0EBFCD88</code></pre><p>The output of the previous command will look similar to the code block below and must match this fingerprint:
<code>9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88</code></p><pre class="language-text"><code class="language-text">pub   4096R/0EBFCD88 2017-02-22
      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;
sub   4096R/F273FCD8 2017-02-22</code></pre><p>Finally we can install Docker</p><pre class="language-shell"><code class="language-shell">$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update
$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> docker-ce docker-ce-cli containerd.io</code></pre><h3 id="2-install-the-nvidia-container-toolkit"><a href="#2-install-the-nvidia-container-toolkit" aria-hidden="true"><span class="icon icon-link"></span></a>2) Install the NVIDIA Container Toolkit</h3><p>The NVIDIA Container Toolkit provides utilities that make it easier to use NVIDIA GPUs within a Docker container. These
instructions are again relevant to Ubuntu and Debian systems. Check the 
<a href="https://github.com/NVIDIA/nvidia-docker" target="_blank" rel="nofollow noopener noreferrer">Nvidia Container Toolkit repo</a> for instructions to install on other 
distributions.</p><p>First we must add the repository to our package manager.</p><pre class="language-shell"><code class="language-shell">$ <span class="token assign-left variable">distribution</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">.</span> /etc/os-release<span class="token punctuation">;</span><span class="token builtin class-name">echo</span> $ID$VERSION_ID<span class="token variable">)</span></span>
$ <span class="token function">curl</span> -s -L https://nvidia.github.io/nvidia-docker/gpgkey <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
$ <span class="token function">curl</span> -s -L https://nvidia.github.io/nvidia-docker/<span class="token variable">$distribution</span>/nvidia-docker.list <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token punctuation">\</span>
    /etc/apt/sources.list.d/nvidia-docker.list</code></pre><p>Then we update our package manager's sources, and install the NVIDIA Container Toolkit</p><pre class="language-shell"><code class="language-shell">$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y nvidia-container-toolkit
$ <span class="token function">sudo</span> systemctl restart docker</code></pre><p>At this point if everything installed successfully, then you should have both Docker and NVIDIA Container Toolkit on
your system.</p><h1 id="2---running-smplify-x-on-your-own-images"><a href="#2---running-smplify-x-on-your-own-images" aria-hidden="true"><span class="icon icon-link"></span></a>2 - Running SMPLify-X on Your Own Images</h1><p>Once you have both Docker and the NVIDIA Container Toolkit setup, using the containerized versions of OpenPose and 
the SMPLify-X is pretty straightforward. Clone my <a href="https://github.com/kidkych/smplifyx-and-openpose-containers" target="_blank" rel="nofollow noopener noreferrer">repo</a> 
and place the images for which you want to generate 3D body models into the <code>data/images</code>  directory. Then simply run
the <code>run_both.sh</code> script and both the OpenPose and SMPLify-X containers will be built and used. First the images will be
run through OpenPose to get 2D keypoints (they can be found under <code>data/keypoints</code> after OpenPose is run), followed by
both the keypoints and images being used by SMPLify-X to generate the body models. The outputs of SMPLify-X including
images with the body models rendered on top will be in the <code>outputs</code> directory.</p><p>To use the SMPLify-X container, you will need to download the necessary pretrained weights from the project website. You
will need to register for an account, and place them in the <code>smplify-x/models</code> directory. The models are available
<a href="https://smpl-x.is.tue.mpg.de/downloads" target="_blank" rel="nofollow noopener noreferrer">here</a>. You will need to download the SMPL-X model, the VPoser model, and the 
Homogenus model. You will also need the <code>smplx_parts_segm.pkl</code> model from 
<a href="https://owncloud.tuebingen.mpg.de/index.php/s/MWnr8Kso4K8T8at" target="_blank" rel="nofollow noopener noreferrer">here</a>. The structure of the directory should look as 
follows:</p><pre class="language-shell"><code class="language-shell">smplify-x/
    -<span class="token operator">&gt;</span> models/
      -<span class="token operator">&gt;</span> homogenus_v1_0/*
      -<span class="token operator">&gt;</span> smplx/*        
      -<span class="token operator">&gt;</span> vposer_v1_0/*        
      -<span class="token operator">&gt;</span> smplx_parts_segm.pkl</code></pre><p>When running the containers, you will be asked for your password to perform root level tasks. This includes changing the
ownership of files produced within containers, and to bind your host's X-Session to the Docker Container. This is 
required because SMPLify-X requires access to an OpenGL environment to visualize the rendering, and this will require a
screen to display.</p><p>Please keep in mind that the first time you run these containers, the images will need to be built. This means that 
within the container the dependencies will be built, and based on your system this may take up to 20-30 minutes if not 
more. Also, if you only wish to run one of the OpenPose or SMPLify-X containers, then the relevant script can be used
independently. You can use the containers as follows:</p><pre class="language-shell"><code class="language-shell">$ <span class="token function">git</span> clone https://github.com/kidkych/smplifyx-and-openpose-containers

$ <span class="token builtin class-name">cd</span> smplifyx-and-openpose-containers

<span class="token comment"># Make sure the necessary files are downloaded and placed in smplify-x/models</span>
<span class="token comment"># and place images of interest into data/images now</span>

$ ./run_both.sh</code></pre><h1 id="3---using-the-smplify-x-container-for-development"><a href="#3---using-the-smplify-x-container-for-development" aria-hidden="true"><span class="icon icon-link"></span></a>3 - Using the SMPLify-X Container for Development</h1><p>If you wish to use SMPLify-X as a part of your own python code, this is possible using bind-mounts in Docker. Simply
add the directory containing your source code as a bind mount and execute your code's entrypoint when starting the 
container as such:</p><pre class="language-shell"><code class="language-shell">docker run --rm -it --gpus all <span class="token punctuation">\</span>
  -v &quot;path_to_source_code:/home/src <span class="token punctuation">\</span>
  smplifyx_container:latest <span class="token punctuation">\</span>
  python3 /home/src/main.py</code></pre><p>you will also need to modify the <code>sys.path</code> variable in the file you first import the smplifyx packages. This would 
be done as follows:</p><pre class="language-python"><code class="language-python"><span class="token comment"># path_to_source_code/main.py</span>
sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;/home/repos/smplify-x/smplifyx&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> fit_single_frame <span class="token keyword">import</span> fit_single_frame

<span class="token comment"># do something </span></code></pre><p>If you wish to use a debugger while developing your code base, I would suggest using the extensions for VS Code, or 
PyCharm both of which greatly simplify the process. I personally use PyCharm when developing within a container but 
either will work fine.</p><ul><li><a href="https://www.jetbrains.com/help/pycharm/using-docker-as-a-remote-interpreter.html" target="_blank" rel="nofollow noopener noreferrer">PyCharm Docker Plugin</a> (This 
  requires the professional version of PyCharm. If you are a student you can get it for free 
  <a href="https://www.jetbrains.com/community/education/#students" target="_blank" rel="nofollow noopener noreferrer">here</a>)</li><li><a href="https://code.visualstudio.com/docs/containers/debug-common" target="_blank" rel="nofollow noopener noreferrer">VS Code Docker Plugin</a></li></ul></div></div></div></div><div id="commentSection" class="section"><div class="container"><div id="disqus_thread" identifier="/blog/getting-started-with-open-pose-and-smp-lify-x/" url="https://kychdev.net//blog/getting-started-with-open-pose-and-smp-lify-x/" style="min-height:200px;"></div></div></div></div></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"id":"2aadb6f2fb5ccc029f658450fe943d33","title":"Getting Started with OpenPose & SMPLify-X","path":"\u002Fblog\u002Fgetting-started-with-open-pose-and-smp-lify-x\u002F","part":0,"authors":"Chirag Karia","date":"2020-08-07T00:00:00.000Z","cover":"https:\u002F\u002Fraw.githubusercontent.com\u002Fvchoutas\u002Fsmplify-x\u002Fmaster\u002Fimages\u002Fteaser_fig.png","collection":null,"tags":[{"id":"3D Body Models","path":"\u002Ftags\u002F3-d-body-models\u002F"},{"id":"Development Environment","path":"\u002Ftags\u002Fdevelopment-environment\u002F"},{"id":"Docker","path":"\u002Ftags\u002Fdocker\u002F"},{"id":"OpenPose","path":"\u002Ftags\u002Fopen-pose\u002F"},{"id":"SMPLify-X","path":"\u002Ftags\u002Fsmp-lify-x\u002F"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.c9f38b1d.js" defer></script><script src="/assets/js/page--src--templates--blogpost-vue.9b21b359.js" defer></script><script src="/assets/js/vue-remark--content--blog--01-smplifyx-containers-md.b7d749c7.js" defer></script>
  </body>
</html>
